<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>BizTask Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <style>
        :root { --primary-color: #2563eb; --bg-color: #f1f5f9; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: var(--bg-color); padding: 20px; margin: 0; }
        .container { max-width: 500px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .input-group { display: flex; flex-direction: column; gap: 12px; }
        
        /* 1. æ¨™æº–çš„ãªå…¥åŠ›æ¬„ã«ã—ã¦ã€Safariã«æ­£ã—ãèªè­˜ã•ã›ã‚‹ */
        input[type="text"], input[type="date"] { 
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid #e2e8f0; 
            font-size: 16px; background: #f8fafc; color: #1e293b;
            -webkit-appearance: none; /* iPhoneç‹¬è‡ªã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ */
        }
        
        /* ãƒ©ãƒ™ãƒ«ï¼ˆèª¬æ˜ï¼‰ã‚’ã¤ã‘ã¦ä½¿ã„ã‚„ã™ãã™ã‚‹ */
        label { font-size: 12px; color: #64748b; font-weight: bold; margin-bottom: -8px; margin-left: 4px; }

        button.add-btn { 
            padding: 16px; border-radius: 10px; background: var(--primary-color); color: white; 
            border: none; font-weight: bold; font-size: 16px; margin-top: 5px;
        }

        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { 
            background: white; padding: 16px; border-radius: 12px; margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .handle { color: #cbd5e1; margin-right: 15px; font-size: 20px; }
        .task-date { font-size: 12px; color: #64748b; font-weight: bold; }
        .delete-btn { background: #fff1f2; color: #e11d48; padding: 10px; border-radius: 8px; border: none; }
        .dragging { opacity: 0.5; transform: scale(0.98); }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center;">BizTask Pro</h2>
    
    <div class="card">
        <div class="input-group">
            <label>ã‚¿ã‚¹ã‚¯å</label>
            <input type="text" id="taskInput" placeholder="ä¾‹ï¼šè³‡æ–™ä½œæˆ" autocomplete="off">
            
            <label>æœŸé™æ—¥</label>
            <input type="date" id="dateInput">
            
            <button class="add-btn" onclick="addTask()">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
        </div>
    </div>

    <ul id="taskList"></ul>
</div>

<script>
    const dayNames = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
    const taskList = document.getElementById('taskList');

    window.onload = () => {
        const savedTasks = JSON.parse(localStorage.getItem('bizTasks')) || [];
        savedTasks.forEach(task => renderTask(task));
        initSortable();
    };

    function addTask() {
        const textInput = document.getElementById('taskInput');
        const dateInput = document.getElementById('dateInput');
        
        if (!textInput.value) return;

        let displayDate = "æœŸé™ãªã—";
        if (dateInput.value) {
            const d = new Date(dateInput.value);
            // 3. ä¿å­˜ã™ã‚‹æ™‚ã«ã€Œæ›œæ—¥ã€ã‚’è¨ˆç®—ã—ã¦ã‚»ãƒƒãƒˆã™ã‚‹
            displayDate = `${dateInput.value.replace(/-/g, '/')} (${dayNames[d.getDay()]})`;
        }

        const newTask = { id: Date.now(), text: textInput.value, date: displayDate };
        const tasks = JSON.parse(localStorage.getItem('bizTasks')) || [];
        tasks.push(newTask);
        localStorage.setItem('bizTasks', JSON.stringify(tasks));
        
        renderTask(newTask);
        textInput.value = '';
        dateInput.value = '';
        textInput.blur();
    }

    function renderTask(task) {
        const li = document.createElement('li');
        li.setAttribute('data-id', task.id);
        li.innerHTML = `
            <div style="display:flex; align-items:center;">
                <div class="handle">â˜°</div>
                <div>
                    <div style="font-weight:600;">${task.text}</div>
                    <span class="task-date">ğŸ“… ${task.date}</span>
                </div>
            </div>
            <button class="delete-btn" onclick="deleteTask(${task.id})">å‰Šé™¤</button>
        `;
        taskList.appendChild(li);
    }

    function deleteTask(id) {
        const tasks = JSON.parse(localStorage.getItem('bizTasks')).filter(t => t.id != id);
        localStorage.setItem('bizTasks', JSON.stringify(tasks));
        document.querySelector(`li[data-id="${id}"]`).remove();
    }

    // iPhoneç”¨ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
    function initSortable() {
        let dragItem = null;
        
        taskList.addEventListener('touchstart', (e) => {
            if (e.target.tagName === 'BUTTON') return;
            dragItem = e.target.closest('li');
            dragItem.classList.add('dragging');
        }, { passive: false });

        taskList.addEventListener('touchmove', (e) => {
            if (!dragItem) return;
            e.preventDefault();
            const touchY = e.touches[0].clientY;
            const elements = [...taskList.querySelectorAll('li:not(.dragging)')];
            const nextElement = elements.find(el => {
                const box = el.getBoundingClientRect();
                return touchY < box.top + box.height / 2;
            });
            taskList.insertBefore(dragItem, nextElement);
        }, { passive: false });

        taskList.addEventListener('touchend', () => {
            if (dragItem) {
                dragItem.classList.remove('dragging');
                const items = [...taskList.querySelectorAll('li')];
                const oldTasks = JSON.parse(localStorage.getItem('bizTasks'));
                const newTasks = items.map(item => oldTasks.find(t => t.id == item.dataset.id));
                localStorage.setItem('bizTasks', JSON.stringify(newTasks));
                dragItem = null;
            }
        });
    }
</script>
</body>
</html>
